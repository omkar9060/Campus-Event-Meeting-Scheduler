<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Campus Event Scheduler</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>

        body {
            background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
            min-height: 100vh;
            color: white;
            font-family: 'Segoe UI', sans-serif;
        }

        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.08);
        }

        .card-glass {
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(14px);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            transition: 0.3s;
        }

        .card-glass:hover {
            transform: translateY(-5px);
        }

        .btn-primary {
            border-radius: 12px;
        }

        .modal-content {
            background: #1e293b;
            color: white;
            border-radius: 18px;
        }

        input {
            border-radius: 10px !important;
        }

        .badge-date {
            background: #00c6ff;
        }

    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark px-4">
    <span class="navbar-brand mb-0 h1">ðŸŽ“ Campus Scheduler</span>

    <div>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#eventModal">
            + Add Event
        </button>
        <button class="btn btn-info ms-2" onclick="loadEvents()">Refresh</button>
    </div>
</nav>

<div class="container mt-4">

    <!-- STATS -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card-glass text-center">
                <h3 id="count">0</h3>
                <p>Total Events</p>
            </div>
        </div>
    </div>

    <!-- SORT -->
    <div class="mb-3">
        <select class="form-select w-25" onchange="loadEvents(this.value)">
            <option value="">No Sorting</option>
            <option value="date">Sort by Date</option>
        </select>
    </div>

    <!-- EVENT GRID -->
    <div class="row" id="eventGrid"></div>

</div>

<!-- ADD EVENT MODAL -->
<div class="modal fade" id="eventModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5>Add Event</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <input id="title" class="form-control mb-2" placeholder="Title">
                <input id="org" class="form-control mb-2" placeholder="Organizer">
                <input id="date" type="datetime-local" class="form-control mb-2">
                <input id="cap" class="form-control mb-2" placeholder="Capacity">

            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" onclick="createEvent()">Save Event</button>
            </div>

        </div>
    </div>
</div>

<script>

    async function loadEvents(sort="") {
        let url = "/events";
        if(sort) url += "?sort=" + sort;

        const res = await fetch(url);
        const data = await res.json();

        document.getElementById("count").innerText = data.length;

        document.getElementById("eventGrid").innerHTML =
            data.map(e => `
            <div class="col-md-4 mb-3">
                <div class="card-glass">
                    <h5>${e.title}</h5>
                    <p>${e.organizer}</p>
                    <span class="badge badge-date">${e.dateTime}</span>
                    <p class="mt-2">Capacity: ${e.capacity}</p>

                    <button class="btn btn-sm btn-danger"
                            onclick="deleteEvent(${e.id})">
                            Delete
                    </button>
                </div>
            </div>
            `).join("");
    }


    async function createEvent() {

        const payload = {
            title: title.value.trim(),
            organizer: org.value.trim(),
            dateTime: date.value + ":00",
            capacity: parseInt(cap.value)
        };

        console.log("Sending:", payload);

        try {
            const res = await fetch("/events", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            const text = await res.text();
            console.log("Status:", res.status);
            console.log("Response:", text);

            if(!res.ok){
                alert("Save failed â€” check console");
                return;
            }

            // close modal
            const modal = bootstrap.Modal.getInstance(
                document.getElementById('eventModal'));
            modal.hide();

            // reset form
            title.value="";
            org.value="";
            date.value="";
            cap.value="";

            loadEvents();

        } catch(err){
            console.error("ERROR:", err);
            alert("Request failed â€” see console");
        }
    }
    async function saveEvent() {

    const payload = {
        title: title.value.trim(),
        organizer: org.value.trim(),
        dateTime: date.value + ":00",
        capacity: parseInt(cap.value)
    };

    const res = await fetch("/events", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
    });

    if(res.ok){
        bootstrap.Modal.getInstance(
          document.getElementById('eventModal')).hide();
        loadEvents();
    }
}



    async function deleteEvent(id) {
        await fetch("/events/" + id, { method: "DELETE" });
        loadEvents();
    }

    loadEvents();

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
